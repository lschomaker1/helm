<h1>Quotes</h1>

<div class="d-flex justify-content-between align-items-center mb-3">
  <p class="mb-0 text-muted">
    List of quotes for your division.
  </p>

  <% if policy(Quote).create? %>
    <%= link_to "New Quote", new_quote_path, class: "btn btn-primary" %>
  <% end %>
</div>

<div class="card">
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead>
        <tr>
          <th>#</th>
          <th>Customer</th>
          <th>Division</th>
          <th>Status</th>
          <th>Total Amount</th>
          <th>Created</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @quotes.each do |quote| %>
          <tr>
            <td><%= quote.number.presence || "Q-#{quote.id}" %></td>
            <td><%= quote.customer&.name || "—" %></td>
            <td><%= quote.division&.name || "—" %></td>
            <td><%= quote.status.to_s.titleize %></td>
            <td>
              <% if quote.total_amount.present? %>
                <%= number_to_currency(quote.total_amount) %>
              <% else %>
                —
              <% end %>
            </td>
            <td><%= quote.created_at&.strftime("%Y-%m-%d") || "—" %></td>
            <td class="text-end">
              <%= link_to "View",
                          quote_path(quote),
                          class: "btn btn-sm btn-outline-primary me-1" %>

              <% if policy(quote).update? %>
                <%= link_to "Edit",
                            edit_quote_path(quote),
                            class: "btn btn-sm btn-outline-secondary me-1" %>
              <% end %>

              <% if policy(quote).destroy? %>
                <form action="<%= quote_path(quote) %>"
                      method="post"
                      class="d-inline"
                      onsubmit="return confirm('Are you sure you want to delete this quote?');">
                  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
                  <%= hidden_field_tag :_method, "delete" %>
                  <button type="submit"
                          class="btn btn-sm btn-outline-danger">
                    Delete
                  </button>
                </form>
              <% end %>
            </td>
          </tr>
        <% end %>

        <% if @quotes.empty? %>
          <tr>
            <td colspan="7" class="text-center py-4 text-muted">
              No quotes found.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
